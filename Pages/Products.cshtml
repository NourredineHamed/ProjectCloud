@page
@model WebAppTest.Pages.ProductsModel
@{
    ViewData["Title"] = "Products";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4">Products</h1>

    <!-- Add Product Form -->
    <div class="card mb-4">
        <div class="card-header"><h5 class="mb-0">Add New Product</h5></div>
        <div class="card-body">
            <form id="addForm" class="row g-3">
                <div class="col-md-6">
                    <input name="Name" class="form-control" placeholder="Product Name" required />
                </div>
                <div class="col-md-4">
                    <input name="Price" type="number" step="0.01" class="form-control" placeholder="Price" required />
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">Add Product</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Products Table -->
    <div class="card">
        <div class="card-header"><h5 class="mb-0">All Products</h5></div>
        <div class="card-body">
            <table class="table table-striped table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody id="productsBody">
                    <!-- Dynamic rows will be added here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Load products from API
async function loadProducts() {
    const response = await fetch('/api/products');
    const products = await response.json();
    const tbody = document.getElementById('productsBody');
    tbody.innerHTML = '';

    if (products.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" class="text-center text-muted">No products available.</td></tr>`;
        return;
    }

    products.forEach(p => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${p.id}</td>
            <td>${p.name}</td>
            <td>${p.price.toFixed(2)}</td>
            <td class="text-center">
                <button class="btn btn-sm btn-danger" onclick="deleteProduct(${p.id})">Delete</button>
            </td>`;
        tbody.appendChild(row);
    });
}

// Add product via API
async function addProduct(event) {
    event.preventDefault();
    const form = event.target;
    const name = form.Name.value.trim();
    const price = parseFloat(form.Price.value);

    if (!name || isNaN(price)) return;

    await fetch('/api/products', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({name, price})
    });

    form.reset();
    loadProducts();
}

// Delete product via API
async function deleteProduct(id) {
    if (!confirm('Are you sure you want to delete this product?')) return;
    await fetch(`/api/products/${id}`, { method: 'DELETE' });
    loadProducts();
}

// Attach form submit event
document.getElementById('addForm').addEventListener('submit', addProduct);

// Initial load
loadProducts();
</script>
</body>
</html>
